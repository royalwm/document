### 						智能运维开发平台

#### 用户认证：

​		用户输入用户名密码验证用户名密码是否正确，登录通过，将会开启服务并将自动生成的token存入数据库并且返回给用户，服务端token存入缓存中。

#### 用户模块：

###### 		创建用户		修改用户		修改密码		获取用户详情		用户退出

​	创建用户时，调用服务接口，创建服务。用户退出关闭服务，并清除token缓存。

#### 服务管理：

###### 	创建服务：

​		先创建存储卷，创建服务挂载存储卷。创建用户目录。

###### 	获取服务token:

​		包含将请求服务接口所需token返回，并返回cpu,gpu属性，供用户选择类型创建服务。

###### 	删除服务：

​		通过服务id和name将服务删除。

###### 	通过服务名查询服务：

​		调用查询服务接口，传入服务名即可。

###### 	开启服务：

​		先判断服务状态，如果是开启的话直接返回，如果停止的话，调用开启服务。（停止服务在用户退出时停止，通过判断服务状态来决定是否停止）

#### 项目管理：（两张表，一个是用户下的项目表，一个是公开项目表）

###### 	创建项目：

​		无论是公开还是私有，用户目录都要创建一个文件目录，将默认文件拷贝到用户目录下的work文件夹中。项目关联数据集了，则创建项目与数据集关联，并将数据集拷贝到用户目录的input下。用户上传了项目文件则将文件通过sftp上传到用户work目录下即可。注：项目文件名为项目的名称。

###### 	通过共享标志查询所有项目：

​		share_flag标志位用来标志用户中的项目是否是公开状态，私有为0，公开为1。

###### 	查询当前用户下的项目：

​		与上面的项目多了一个查询条件那就是通过用户user_id查看用户下的所有项目。

###### 	通过项目id查询项目详情（用户）：

​		用户下所有的项目，包括已公开的项目。

###### 	通过项目id查询项目详情（公开）：

​		通过查询公开表，通过id来查出项目详情。

###### 	通过项目id和用户id更新项目（用户）：

​		用户下的所有项目，通过id来更新项目。如果共享标志传过来是0则只更新字段信息，而项目文件不需要移动，更新数据集关联，拷贝数据集到用户目录下，删除没有关联的数据集。

​		如果共享标志为1，则将项目文件拷贝到public/work下，更新字段，更新数据集到公开目录，并且删除用户目录下的没有关联的数据集。

​		更新的时候上传了数据集，则通过sftp上传到对应的目录下（通过共享标志决定哪个目录）。

###### 	通过项目id更新项目（公开）：

​		只更新公开表的数据，更新数据集关联。

###### 	批量删除项目（用户）：

​		删除用户与项目的关联和数据集关联并删除运行文件。

###### 	批量删除项目（公开）：

​		删除公开目录下的运行文件与公开表数据。

###### 	通过项目id和服务名获取运行环境地址（用户）：

​		获取用户下项目文件运行地址。

###### 	通过项目id和服务名获取运行环境地址（公开）：

​		获取公开项目下项目文件运行地址。

###### 	通过项目id查询数据集信息（用户）：

​		通过该项目id关联的数据集，数据集下关联的数据集文件，查出文件表下的相关信息显示在前端。（前端显示树状结构）

###### 	通过项目id查询数据集信息（公开）：

​		查询公开表下项目数据集与文件。

###### 	通过项目id和服务名获取文件内容地址（用户）：

​		获取用户开启的容器运行文件内容地址。

###### 	通过项目id和服务名获取文件内容地址（公开）：

​		获取公开容器地址。

###### 	通过项目id和用户id分享：

​		将数据集拷贝到public目录，将用户下的项目文件移动到公开目录，保存公开项目表。

###### 	查询所有公开项目：

​		查询所有公开项目表。

###### 	通过项目id和用户id公有转私有：

​		添加私有项目，向项目表插入数据，通过用户关联该项目。将公有目录下的文件数据集复制到用户目录下。

#### 数据集管理：

###### 	创建项目集：

​		多文件上传，遍历并保存文件，私有的将文件上传到该用户下的input的目录，目录名以数据集名称来命名，文件已上传的文件名字命名并保持文件表和数据集表。如果存在相同的文件名将会提示。公有的将文件直接保存到public文件夹下的input目录。

###### 	通过数据集id查询数据集详情：

​		查询数据集中is_public 0表示当前用户下的数据集，1表示所有用户下的公开数据集。查询数据集表与其关联的文件信息。

###### 	查询数据集：

​		通过用户id查询，当前用户下的所有数据集及文件信息。

###### 	编辑数据集：

​		保存上传更新的数据集及文件。数据集公开则将数据集复制到公开目录，删除没有数据集关联的文件。

###### 	批量删除数据集：

​		先查询该数据集的is_public标志，如果是0则是用户下的数据集，删除用户下对于的数据集文件即可。如果是1则是公开目录下的数据集，删除公开目录下的数据集文件夹。

###### 	通过文件id查看文件信息：

​		发送head -n 10 du 文件名，查询文件大小，文件信息。

###### 	通过数据集id分享：

​		在公开目录创建数据集目录并复制数据集文件，添加文件表注明公开文件。（用户下的数据集不变），添加一条公开数据集信息。

###### 	通过数据集id修改概述：

​		向数据集表中添加字段描述数据集信息。

###### 	通过数据集id公开转私有：

​		将公开数据集复制到用户目录下。

#### 代码片段库：（只对数据库操作，没有调用其他接口）

###### 	创建代码片段：

###### 	查询代码片段：

###### 	通过父节点id删除：

###### 	通过子节点id删除：

###### 	通过文件id更新：



​		

